<% layout('layout') %>
<% title = 'Dashboard' %>
<%# This content will be injected into the layout file %>
<%# This content will be injected into the layout file %>
<%# This content will be injected into the layout file %>

<h1 class="h3 mb-4 text-gray-800">Add New Ticket (Initiate Payment)</h1>

<div class="card shadow mb-4">
    <div class="card-header py-3">
        <h6 class="m-0 font-weight-bold text-primary">Ticket Details</h6>
    </div>
    <div class="card-body">
        <%# Form submission will now initiate Paystack payment %>
        <form action="/admin/tickets" method="POST">
            <div class="form-group">
                <label for="ticket_type">Ticket Type:</label>
                <select class="form-control" id="ticket_type" name="ticket_type" required>
                    <option value="">-- Select Ticket Type --</option>
                    <% ticketTypes.forEach(type => { %>
                        <option value="<%= type._id %>"><%= type.name %> (<%= type.price.toFixed(2) %>)</option>
                    <% }) %>
                </select>
                 <small class="form-text text-muted">Selecting a type sets the price for Paystack payment.</small>
            </div>
             <%# The input for ticket_code is REMOVED here because it's auto-generated %>
             <%#
             <div class="form-group">
                <label for="ticket_code">Ticket Code:</label>
                <input type="text" class="form-control" id="ticket_code" name="ticket_code" required>
                 <small class="form-text text-muted">A unique code for this ticket instance.</small>
            </div>
             %>
            <div class="form-group">
                <label for="purchaser_name">Purchaser Name:</label>
                <input type="text" class="form-control" id="purchaser_name" name="purchaser_name" required>
            </div>
            <div class="form-group">
                <label for="purchaser_email">Purchaser Email:</label>
                 <%# Email is required by Paystack %>
                <input type="email" class="form-control" id="purchaser_email" name="purchaser_email" required>
                 <small class="form-text text-muted">This email will be used for the Paystack payment.</small>
            </div>
            <div class="form-group">
                <label for="purchaser_phone">Purchaser Phone:</label>
                <input type="text" class="form-control" id="purchaser_phone" name="purchaser_phone" required>
            </div>

             <%# Status and Payment Status are set by the server/Paystack initially %>
             <%# The payment status dropdown was removed as it's handled by Paystack initiation %>
             <%# <input type="hidden" name="status" value="unused"> %>
             <%# <input type="hidden" name="payment_status" value="pending"> %>

            <button type="submit" class="btn btn-primary">Create Ticket & Initiate Payment</button>
            <a href="/admin/tickets" class="btn btn-secondary">Cancel</a>
        </form>
    </div>
</div>
